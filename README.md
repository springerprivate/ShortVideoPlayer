# 小视频播放

## 设计

### 角色

#### 播放管理类
管理播放控制

#### 播放类
单个资源的播放控制

#### 下载管理类
管理下载控制

#### 下载类
单个资源下载控制

#### 缓存控制类
控制缓存

### 关联
播放管理类持有播放类；播放视图持有播放类；
下载管理类持有下载类；播放类持有下载类（若需要资源下载）；

## 考虑
期望：
- 播放流畅
- 播放控制流畅
- 视图及时渲染
- 减少等待时间

- 预加载
  - 预加载方向预判，指定预加载优先级策略
  - 预加载数量限制
  - 预加载时机把握
- 缓存
  - 缓存方式：memory、cache、disk
  - 缓存控制：大小
  - 清理机制：优先级策略（需要维护资源映射表）
- 边播边下载（优先级较低）
  - resource loader
- 及时渲染
  - player预加载，playerlayer预渲染，cell复用。（主要问题：tableview分页时indexpath不连续）
- 普遍问题
  - 线程安全
  - 分层优先级控制
  - 播放控制（与业务强相关）
  - 资源加载控制（并发数控制4-6）。
